---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import Config from '../../utils/config';

export async function getStaticPaths() {
  const posts = await getCollection('posts', ({ data }) => !data.draft);
  return posts.map(post => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();
---

<Layout 
  title={`${post.data.title} | ${Config.siteTitle}`} 
  description={post.data.description}
  image={post.data.image} // Pass image to layout for meta tags
>
  <style>
    /* Article header image (metadata image) */
    .article-header img {
      width: 100%;
      max-height: 500px;
      object-fit: cover;
      border-radius: var(--radius);
      margin: 2rem 0;
      box-shadow: var(--shadow);
    }

    /* Content images (from markdown/mdx) */
    .article-content img {
      width: 100%;
      height: auto;
      border-radius: var(--radius);
      margin: 2rem auto;
      box-shadow: var(--shadow);
      display: block;
    }

    /* Caption styling */
    .article-content img + em,
    .image-caption {
      display: block;
      text-align: center;
      font-size: 0.9rem;
      color: var(--text-light);
      margin-top: -1.5rem;
      margin-bottom: 2rem;
      font-style: normal;
    }

    /* Full-width images */
    .article-content img.full-width {
      width: 100vw;
      max-width: none;
      margin-left: 50%;
      transform: translateX(-50%);
      border-radius: 0;
    }

    /* Small floated images */
    .article-content img.float-left {
      float: left;
      margin: 1rem 1rem 1rem 0;
      max-width: 50%;
    }

    .article-content img.float-right {
      float: right;
      margin: 1rem 0 1rem 1rem;
      max-width: 50%;
    }

    @media (max-width: 768px) {
      .article-header img {
        max-height: 300px;
      }
      
      .article-content img.float-left,
      .article-content img.float-right {
        float: none;
        max-width: 100%;
        margin: 1rem auto;
      }
    }
  </style>

  <article>
    <header class="article-header">
      <h1>{post.data.title}</h1>
      {post.data.image && (
        <img
          src={post.data.image}
          alt={post.data.imageAlt || post.data.title}
          loading="lazy"
        />
      )}
    </header>

    <div class="article-content">
      <Content />
    </div>
  </article>
</Layout>