---
// src/pages/posts/[...page].astro
import Layout from '../../components/Layout.astro';
import PostPreview from '../../components/PostPreview.astro';
import Paginator from '../../components/Paginator.astro';
import { getCollection } from 'astro:content';

const pageSize = 5; // Posts per page
const allPosts = (await getCollection('posts'))
  .filter(post => !post.data.draft)
  .sort((a, b) => new Date(b.data.publishDate) - new Date(a.data.publishDate));

const { page } = Astro.params;
const currentPage = parseInt(page || '1');
const startIdx = (currentPage - 1) * pageSize;
const paginatedPosts = allPosts.slice(startIdx, startIdx + pageSize);
const totalPages = Math.ceil(allPosts.length / pageSize);
---

<Layout title={`Posts - Page ${currentPage}`}>
  <div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold mb-8">Latest News</h1>
    
    <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
      {paginatedPosts.map(post => (
        <PostPreview post={post} />
      ))}
    </div>

    {totalPages > 1 && (
      <Paginator 
        currentPage={currentPage} 
        totalPages={totalPages} 
        baseUrl="/posts" 
      />
    )}
  </div>
</Layout>