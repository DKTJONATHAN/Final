---
import { getCollection } from "astro:content";
import PostPreview from "@/components/blog/PostPreview.astro";
import Note from "@/components/note/Note.astro";
import PageLayout from "@/layouts/Base.astro";
import { siteConfig } from "@/site.config";

const MAX_POSTS = 6;
const MAX_NOTES = 4;

const allPosts = (await getCollection('posts', ({ data }) => !data.draft))
  .sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime())
  .slice(0, MAX_POSTS);

const latestNotes = (await getCollection('notes', ({ data }) => !data.draft))
  .sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime())
  .slice(0, MAX_NOTES);
---

<PageLayout meta={{ title: siteConfig.title, description: siteConfig.description }}>
  <section class="mb-12">
    <h1 class="mb-6 text-4xl font-bold tracking-tight">{siteConfig.title}</h1>
    <p class="mb-6 text-lg text-gray-700 dark:text-gray-300">
      {siteConfig.description}
    </p>
  </section>

  <section class="mb-12">
    <div class="flex items-center justify-between mb-6">
      <h2 class="text-2xl font-bold">
        <a href="/posts/" class="hover:text-red-600 dark:hover:text-red-400 transition-colors">
          Top Stories
        </a>
      </h2>
      <a href="/posts/" class="text-sm font-medium hover:underline">
        View All →
      </a>
    </div>
    <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
      {allPosts.map((post) => (
        <PostPreview post={post} />
      ))}
    </div>
  </section>

  {latestNotes.length > 0 && (
    <section class="mb-12">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-bold">
          <a href="/notes/" class="hover:text-red-600 dark:hover:text-red-400 transition-colors">
            Latest Notes
          </a>
        </h2>
        <a href="/notes/" class="text-sm font-medium hover:underline">
          View All →
        </a>
      </div>
      <div class="grid gap-6 md:grid-cols-2">
        {latestNotes.map((note) => (
          <Note note={note} isPreview />
        ))}
      </div>
    </section>
  )}
</PageLayout>