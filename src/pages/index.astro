---
// src/pages/index.astro
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';

// Get ALL posts sorted by date (newest first), ignoring featured status
const allPosts = (await getCollection('posts'))
  .sort((a, b) => new Date(b.data.date) - new Date(a.data.date));
---

<Layout title="Latest News | Jonathan Mwaniki" description="The latest news and articles from Jonathan Mwaniki">
    <style>
        .posts-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .posts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 2rem;
        }
        
        .post-card {
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .post-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .post-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }
        
        .post-content {
            padding: 1.25rem;
        }
        
        .post-meta {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
            color: #4a5568;
        }
        
        .post-category {
            background: #f0f4f8;
            color: #2b6cb0;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-weight: 500;
        }
        
        .post-date {
            color: #718096;
        }
        
        .post-title {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
            color: #1a365d;
        }
        
        .post-excerpt {
            color: #4a5568;
            margin-bottom: 1rem;
        }
        
        .read-more {
            color: #2b6cb0;
            font-weight: 500;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
        }
        
        .read-more svg {
            margin-left: 0.25rem;
            width: 1rem;
            height: 1rem;
        }
        
        .draft-badge {
            background: #f0f0f0;
            color: #666;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            margin-left: 0.5rem;
        }
        
        @media (max-width: 768px) {
            .posts-container {
                padding: 1rem;
            }
            
            .posts-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>

    <div class="posts-container">
        <h1>Latest News</h1>
        <div class="posts-grid">
            {allPosts.map(post => (
                <a 
                    href={`https://www.jonathanmwaniki.co.ke/posts/${post.slug}`} 
                    class="post-card"
                >
                    <img
                        src={post.data.image}
                        alt={post.data.imageAlt || post.data.title}
                        class="post-image"
                        loading="lazy"
                        width="400"
                        height="225"
                    />
                    <div class="post-content">
                        <div class="post-meta">
                            <span class="post-category">{post.data.category}</span>
                            <span class="post-date">
                                {new Date(post.data.date).toLocaleDateString('en-US', {
                                    year: 'numeric',
                                    month: 'short',
                                    day: 'numeric'
                                })}
                            </span>
                        </div>
                        <h3 class="post-title">{post.data.title}</h3>
                        <p class="post-excerpt">{post.data.description}</p>
                        <span class="read-more">
                            Read more
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                            </svg>
                        </span>
                        {post.data.draft && <span class="draft-badge">DRAFT</span>}
                    </div>
                </a>
            ))}
        </div>
    </div>
</Layout>