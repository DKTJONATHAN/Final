---
// src/pages/index.astro
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const allPosts = (await getCollection('posts'))
  .sort((a, b) => new Date(b.data.date) - new Date(a.data.date));

const categories = ['All', ...new Set(allPosts.map(post => post.data.category))];
---

<Layout title="Latest News | Jonathan Mwaniki">
    <!-- Ad 1: Top of page (below header) -->
    <div class="ad-container ad-top">
        <script type="text/javascript">
            atOptions = {
                'key' : '1610960d9ced232cc76d8f5510ee4608',
                'format' : 'iframe',
                'height' : 60,
                'width' : 468,
                'params' : {}
            };
        </script>
        <script type="text/javascript" src="//www.highperformanceformat.com/1610960d9ced232cc76d8f5510ee4608/invoke.js"></script>
    </div>

    <div class="posts-container">
        <header class="page-header">
            <h1>Latest News</h1>
            <p>Stay updated with the latest insights</p>
            
            <div class="category-tabs">
                {categories.map(category => (
                    <button class="tab" onclick={`filterPosts('${category}')`}>
                        {category}
                    </button>
                ))}
            </div>
        </header>

        <!-- Ad 2: After first 2 posts -->
        <div class="posts-grid">
            {allPosts.map((post, index) => (
                <>
                    <article class="post-card" data-category={post.data.category}>
                        <!-- Your post content -->
                    </article>

                    {index === 1 && (
                        <div class="ad-container ad-middle">
                            <script type="text/javascript">
                                atOptions = {
                                    'key' : '1610960d9ced232cc76d8f5510ee4608',
                                    'format' : 'iframe',
                                    'height' : 60,
                                    'width' : 468,
                                    'params' : {}
                                };
                            </script>
                            <script type="text/javascript" src="//www.highperformanceformat.com/1610960d9ced232cc76d8f5510ee4608/invoke.js"></script>
                        </div>
                    )}
                </>
            ))}
        </div>

        <!-- Ad 3: Bottom of page -->
        <div class="ad-container ad-bottom">
            <script type="text/javascript">
                atOptions = {
                    'key' : '1610960d9ced232cc76d8f5510ee4608',
                    'format' : 'iframe',
                    'height' : 60,
                    'width' : 468,
                    'params' : {}
                };
            </script>
            <script type="text/javascript" src="//www.highperformanceformat.com/1610960d9ced232cc76d8f5510ee4608/invoke.js"></script>
        </div>
    </div>

    <style>
        /* Ad styling (professional, non-intrusive) */
        .ad-container {
            margin: 2rem auto;
            text-align: center;
            padding: 1rem;
            background: #f8f8f8;
            border-radius: 4px;
        }
        .ad-top { margin-top: 0; }
        .ad-middle { grid-column: 1 / -1; } /* Full width in grid */
        
        /* Your existing styles */
        .posts-grid { /* ... */ }
        .post-card { /* ... */ }
    </style>

    <script is:inline>
        // Your existing filterPosts() function
    </script>
</Layout>