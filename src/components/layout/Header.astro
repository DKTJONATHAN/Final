---
import Search from "@/components/Search.astro";
import ThemeToggle from "@/components/ThemeToggle.astro";
import { menuLinks } from "@/site.config";
import { siteConfig } from "../../site.config";
---

<header
  class="w-screen relative left-1/2 right-1/2 -mx-[50vw] bg-white dark:bg-gray-900 text-gray-900 dark:text-white shadow-md border-b border-gray-200 dark:border-gray-700"
  id="main-header"
>
  <div class="w-full">
    <!-- Top Section: Title and Tagline -->
    <div class="container mx-auto px-4 py-3 text-center">
      <div class="flex flex-col items-center">
        <!-- Logo (centered above title) -->
        <img
          class="h-16 w-auto mb-2"
          src="/Jonathan-Mwaniki-logo.png"
          alt="The Mwaniki Reports Logo"
        />
        
        <!-- Title and Tagline -->
        <h1 class="text-3xl md:text-4xl font-bold font-serif tracking-tight">
          {siteConfig.title}
        </h1>
        <p class="text-sm md:text-base text-gray-600 dark:text-gray-300 mt-1">
          Delivering trusted news from Kenya and beyond
        </p>
      </div>
    </div>

    <!-- Navigation Bar -->
    <div class="bg-gray-100 dark:bg-gray-800 w-full py-2">
      <div class="container mx-auto px-4 flex flex-col md:flex-row items-center justify-between">
        <!-- Desktop Navigation -->
        <nav
          aria-label="Main menu"
          class="hidden md:flex items-center space-x-1"
        >
          {menuLinks.map((link) => (
            <a
              aria-current={Astro.url.pathname === link.path ? "page" : false}
              class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md transition-colors"
              data-astro-prefetch
              href={link.path}
            >
              {link.title}
            </a>
          ))}
        </nav>

        <!-- Utility Controls -->
        <div class="flex items-center space-x-4 mt-2 md:mt-0">
          <Search />
          <ThemeToggle />
          
          <!-- Mobile Menu Button -->
          <button
            aria-expanded="false"
            aria-haspopup="menu"
            aria-label="Toggle menu"
            class="md:hidden p-2 rounded-md text-gray-700 dark:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-700"
            id="toggle-navigation-menu"
            type="button"
          >
            <svg
              class="h-6 w-6 transition-all group-aria-expanded:hidden"
              fill="none"
              stroke="currentColor"
              stroke-width="1.5"
              viewBox="0 0 24 24"
            >
              <path
                d="M3.75 9h16.5m-16.5 6.75h16.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
            <svg
              class="h-6 w-6 hidden transition-all group-aria-expanded:block"
              fill="none"
              stroke="currentColor"
              stroke-width="1.5"
              viewBox="0 0 24 24"
            >
              <path
                d="M6 18L18 6M6 6l12 12"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- Mobile Menu -->
    <nav
      aria-label="Mobile menu"
      class="md:hidden bg-gray-100 dark:bg-gray-800 w-full hidden group-[.menu-open]:block"
      id="mobile-navigation-menu"
    >
      <div class="flex flex-col items-center py-2 space-y-1">
        {menuLinks.map((link) => (
          <a
            aria-current={Astro.url.pathname === link.path ? "page" : false}
            class="w-full text-center py-2 px-4 text-gray-700 dark:text-gray-200 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-gray-200 dark:hover:bg-gray-700"
            data-astro-prefetch
            href={link.path}
          >
            {link.title}
          </a>
        ))}
      </div>
    </nav>
  </div>
</header>

<script>
  import { toggleClass } from "@/utils/domElement";

  class MobileNavBtn extends HTMLElement {
    #menuOpen: boolean = false;

    connectedCallback() {
      const headerEl = document.getElementById("main-header");
      const mobileButtonEl = this.querySelector("#toggle-navigation-menu");

      mobileButtonEl?.addEventListener("click", () => {
        if (headerEl) toggleClass(headerEl, "menu-open");
        this.#menuOpen = !this.#menuOpen;
        mobileButtonEl.setAttribute("aria-expanded", this.#menuOpen.toString());
      });
    }
  }

  customElements.define("mobile-button", MobileNavBtn);
</script>

<style is:global>
  /* Ensure full width display */
  #main-header {
    width: 100vw;
    position: relative;
    left: 50%;
    right: 50%;
    margin-left: -50vw;
    margin-right: -50vw;
  }

  /* Smooth transitions */
  #main-header a, #main-header button {
    transition: all 0.2s ease;
  }

  /* Focus styles */
  #main-header a:focus, #main-header button:focus {
    outline: 2px solid #3b82f6;
    outline-offset: 2px;
  }

  /* Dark mode compatibility */
  @media (prefers-color-scheme: dark) {
    #main-header a:focus, #main-header button:focus {
      outline-color: #60a5fa;
    }
  }

  /* Remove default body margins */
  body {
    margin: 0;
    padding: 0;
  }
</style>