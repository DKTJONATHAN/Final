<script is:inline>
	const themePref = window.matchMedia("(prefers-color-scheme: light)");
	
	function getTheme() {
		const saved = typeof localStorage !== "undefined" && localStorage.getItem("theme");
		return saved || (themePref.matches ? "light" : "dark");
	}

	function applyTheme(theme) {
		if (!["light", "dark"].includes(theme)) return;
		
		const root = document.documentElement;
		if (theme === root.dataset.theme) return;
		
		root.dataset.theme = theme;
		localStorage?.setItem("theme", theme);
	}

	// Initial load
	applyTheme(getTheme());

	// View Transitions support
	document.addEventListener("astro:after-swap", () => applyTheme(getTheme()));

	// Theme toggle event
	document.addEventListener("theme-change", (e) => applyTheme(e.detail.theme));

	// System preference changes
	themePref.addEventListener("change", (e) => applyTheme(e.matches ? "light" : "dark"));
</script>